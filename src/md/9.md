---
filename: 9.md
tags:
  - spring
  - springboot
  - jmeter
category: jmeter
title: LIKE 검색 테스트
created: Sun, 10 Aug 2025 15:01:25 GMT
---

## 채널 검색 기능

<p style="display:flex;justify-content:center">
  <img src="../../images/9/1.png" width="45%" alt="image"/>
</p>

- 채팅 제목을 검색하는 서비스를 제공하고 있습니다
- 전문검색, 장문의 스트링을 검색하는 경우에는 Elasticsearch를 고려해야 합니다
- 비교적 짧고 단순한 스트링을 검색하기에 `LIKE` 검색을 사용하고 있습니다

### LIKE 검색

```java title="Channel.java"
package com.api.backend.domain;

import java.time.LocalDateTime;

import org.hibernate.annotations.CreationTimestamp;

import jakarta.persistence.*;
import lombok.*;

@Entity
@Table(name = "channels")
@Getter
@Setter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
@Builder
public class Channel {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "public_id", nullable = false, unique = true, updatable = false, length = 36)
    private String publicId;

    @Column(nullable = false)
    private String name;

    @Column(name = "creator_id", nullable = false)
    private Long creatorId;

    @Column(name = "member_count", nullable = false)
    private int memberCount;

    @CreationTimestamp
    @Column(updatable = false)
    private LocalDateTime createdAt;
}
```

- Channel 검색에서 이용되는 부분은 `name` column 입니다
- `name` column에 인덱스를 설정하지 않았습니다

```java title="ChannelRepository.java"
package com.api.backend.repository;

import java.util.List;

import com.api.backend.domain.Channel;

public interface ChannelRepository extends JpaRepository<Channel, Long> {
...
    @Query(value = """
            SELECT *
            FROM channels
            WHERE REPLACE(LOWER(name), ' ', '')
                  LIKE CONCAT('%', REPLACE(LOWER(:keyword), ' ', ''), '%')
              AND (
                  :cursor IS NULL
                  OR (
                      :asc = true AND public_id > :cursor
                      OR :asc = false AND public_id < :cursor
                  )
              )
            ORDER BY
                CASE WHEN :asc = true THEN public_id END ASC,
                CASE WHEN :asc = false THEN public_id END DESC
            LIMIT :size
            """, nativeQuery = true)
    List<Channel> search(
            @Param("keyword") String keyword,
            @Param("cursor") String cursor,
            @Param("asc") boolean asc,
            @Param("size") int size);

...
}
```

- 검색 키워드와 검색 대상인 `name` column을 모두 소문자로 바꾸고, 공백을 모두 없앤 뒤, 검색 키워드 양 옆에 `%`를 붙여 부분 일치를 확인합니다
- 해당 서비스로 구성된 엔드포인트를 Jmeter를 통해 테스트하겠습니다